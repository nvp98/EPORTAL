
@{
    ViewBag.Title = "Index";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
@using EPORTAL.ModelsTagSign
@model PagedList.IPagedList<CalendarValidation>
@using PagedList.Mvc
@using EPORTAL.ModelsView360;
@using EPORTAL.ModelsTagSign;
@using System.Collections;

@if (TempData["msgSuccess"] != null)
{
    @Html.Raw(TempData["msgSuccess"])
}
@if (TempData["msgError"] != null)
{
    @Html.Raw(TempData["msgError"])
}
@{
    EPORTALEntities db = new EPORTALEntities();
    List<String> listThang = new List<String>();
    var nam = "";
}
<style>
* {box-sizing: border-box;}
ul {list-style-type: none;}
body {font-family: Verdana, sans-serif;}

.month {
  padding: 25px 25px;
  width: 100%;
  background: #1abc9c;
  text-align: center;
}

.month ul {
  margin: 0;
  padding: 0;
}

.month ul li {
  color: white;
  font-size: 20px;
  text-transform: uppercase;
  letter-spacing: 3px;
}

.month .prev {
  float: left;
  padding-top: 10px;
}

.month .next {
  float: right;
  padding-top: 10px;
}

.weekdays {
  margin: 0;
  padding: 10px 0;
  background-color: #ddd;
}

.weekdays li {
  display: inline-block;
  width: 13.9%;
  color: #666;
  text-align: center;
}

.card-body {
 background-image: url("/Content/Images/backgroup.png");
 
}
.days {
    padding:0px;
}
.days li {
  list-style-type: none;
  display: inline-block;
  width: 13.6%;
  text-align: center;
  margin-bottom: 3px;
  font-size:12px;
  color: black;
  height:130px;
  border: ridge;
  padding-top:0.5%;
  border-radius: 10px;
}

.days li .active {
  padding: 5px;
  background: #1abc9c;
  color: white !important
}
.pagination {
  display: inline-block;
}

.pagination a {
  color: white;
  float: left;
  padding: 8px 16px;
  text-decoration: none;
  font-weight: bold;
  
}
.pagination a {
  
  margin-left: 6px; 
 
}
.pagination a.active {
  background-color: #4CAF50;
  color: black;
  border-radius: 5px;
}

.pagination a:hover:not(.active) {
  background-color: #ddd;
  border-radius: 5px;
}
.show {
    display : block;
}
.hide {
    display : none;
}
.backUp {
    color: black !important;
    -moz-border-radius: 100px !important;
	-webkit-border-radius: 100px !important;
	border-radius: 100px !important;
    background-color: white !important;
}
.backUp:hover {
    
    background-color: #c3d6e7 !important;
}
</style>
<link href="~/Content/PagedList.css" rel="stylesheet" />
<div class="app-main__outer">
    <div class="app-main__inner">

        <div class="app-page-title">
            <div class="page-title-wrapper">
                <div class="page-title-heading">
                    <div class="page-title-icon">
                        <i class="pe-7s-portfolio icon-gradient bg-grow-early">
                        </i>
                    </div>
                    <div>
                        Danh sách lịch bay
                        <div class="page-title-subheading">
                        </div>
                    </div>
                </div>

            </div>
        </div>

        <div class="tab-content">
            <div class="row">
                <div class="card">

                    <div class="card-header">
                        <div class="row" style="width:100%">
                            <div class="col-md-12 pull-right">
                                &nbsp;
                                <button type="button" id="btn-add" class="btn btn-primary " style="margin-left:10px;float:right"><i class="fa fa-plus">&nbsp;</i>&nbsp;Nhập kế hoạch </button>
                                <div class="modal" id="myModal" role="dialog" data-url='@Url.Action("Create","Calendar")' style="margin-top:50px"></div>
                                &nbsp;
                                <button type="button" id="btn-Import" class="btn btn-primary m-l-auto pull-right"><i class="fa fa-upload">&nbsp;</i>&nbsp;Upload </button>
                                <div class="modal" id="myModalImport" role="dialog" data-url='@Url.Action("ImportExcel","Calendar")' style="margin-top:50px"></div>
                                &nbsp;
                                <button type="button" id="btn-Export" class="btn btn-primary pull-right" style="margin-right:1%;"><i class="fa fa-file-excel-o">&nbsp;</i>&nbsp;Xuất Excel</button>
                                &nbsp;
                            </div>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive" style="display:flex;">
                            <div style="width:50%;">
                                @{
                                    var Begindd = Request.QueryString["begind"];
                                    var End = Request.QueryString["endd"];

                                    <div>
                                        @if (Begindd != null || End != null)
                                        {
                                            var Day = DateTime.ParseExact(Begindd, "yyyy-MM-dd", System.Globalization.CultureInfo.InvariantCulture, System.Globalization.DateTimeStyles.None);
                                            var mm = Day.ToString("MM");
                                            var yyyy = Day.ToString("yyyy");
                                            <div style="margin-left: -11%;" class="text-center">
                                                <ul>
                                                    <li>
                                                        <h4 style="color:white;">
                                                            <b id="thang">Tháng @mm/@yyyy</b>
                                                        </h4>

                                                    </li>
                                                </ul>
                                            </div>
                                        }
                                        else
                                        {
                                            DateTime Now = DateTime.Now;
                                            var mm = Now.ToString("MM");
                                            var yyyy = Now.ToString("yyyy");
                                            <div style="margin-left: -11%;" class="text-center">
                                                <ul>
                                                    <li>
                                                        <h4 style="color: white;">
                                                            <b id="thang">Tháng @mm/@yyyy</b>
                                                        </h4>

                                                    </li>
                                                </ul>
                                            </div>
                                        }
                                    </div>
                                    <div class="Search" style="border: ridge; height: 180px; margin: 0 5% 0 0; padding: 5%; margin-top: 5%; border-radius: 10px; background-color: white; ">
                                        <div style="display:flex; margin-bottom:5%;">
                                            <span class="text-center" style="margin-top: 8px; padding-left: 1%; "><b>Từ ngày &nbsp;  :</b></span>
                                            <div class="col-md-8">
                                                @Html.TextBox("begind", null, new { @id = "begind", @type = "date", @class = "form-control", })
                                            </div>

                                        </div>
                                        <div style="display:flex;">
                                            <span class="text-center" style="margin-top: 8px"><b>Đến ngày :</b></span>
                                            <br />
                                            <div class="col-md-8">
                                                @Html.TextBox("endd", null, new { @id = "endd", @type = "date", @class = "form-control" })
                                            </div>
                                        </div>

                                        <div class="col-md-8" style="margin-top: 8px;margin-left: 55%;">
                                            <button class="btn btn-primary" id="btn-search"><i class="fa fa-search"></i> Tìm kiếm</button>
                                        </div>
                                    </div>
                                    <div class="Search" style="border: ridge; height: 380px; margin: 0 5% 0 0; padding: 5%; margin-top: 5%; overflow-y: auto; overflow-x: hidden; background-color: white;">
                                        @*<div>
                                            <ul class="text-center" style="padding: 0px !important">
                                                <li>
                                                    <h6>
                                                        <b>
                                                            Tổng số lần thực hiện
                                                        </b>
                                                    </h6>

                                                </li>
                                            </ul>
                                        </div>*@
                                        <div>

                                            @if (Begindd != null || End != null)
                                            {
                                                List<string> TenKH = new List<string>();
                                                var DayBegind = DateTime.ParseExact(Begindd, "yyyy-MM-dd", System.Globalization.CultureInfo.InvariantCulture, System.Globalization.DateTimeStyles.None);
                                                var DayEnd = DateTime.ParseExact(End, "yyyy-MM-dd", System.Globalization.CultureInfo.InvariantCulture, System.Globalization.DateTimeStyles.None);
                                                var startDay = new DateTime(DayBegind.Year, DayBegind.Month, 1);
                                                var endDay = startDay.AddMonths(1).AddDays(-1);
                                                <div text-align: center !important;style=" margin-left: -5%;">
                                                    <ul class="text-center" style="padding: 0px !important">
                                                        <li>
                                                            <span>
                                                                <b>
                                                                    TỪ @DayBegind.ToString("dd/MM/yyyy") Đến @DayEnd.ToString("dd/MM/yyyy")
                                                                </b>
                                                            </span>

                                                        </li>
                                                    </ul>
                                                </div>
                                                <div>
                                                    <table class="table table-bordered table-hover" id="table" width="100%" cellpadding="0">
                                                        <thead>
                                                            <tr>
                                                                <th width="30px" class="text-center">STT</th>
                                                                <th class="text-center">Tên kế hoạch</th>
                                                                <th class="text-center">Số lượng</th>
                                                            </tr>
                                                        </thead>
                                                        <tbody>
                                                            @{

                                                                var Data = db.Calenders.Where(x => x.Date >= DayBegind && x.Date <= DayEnd).ToList();
                                                                foreach (var dt in Data)
                                                                {
                                                                    TenKH.Add(dt.ShortName);
                                                                    //if (TenKH.Count == 0)
                                                                    //{
                                                                    //    TenKH.Push(dt.ShortName);
                                                                    //}
                                                                    //foreach (var kh in TenKH)
                                                                    //{

                                                                    //    if (dt.ShortName != kh.ToString())
                                                                    //    {
                                                                    //        TenKH.Push(dt.ShortName);
                                                                    //        break;
                                                                    //    }

                                                                    //}

                                                                }
                                                                TenKH = TenKH.Distinct().ToList();
                                                                int stt = 1;
                                                                foreach (var name in TenKH)
                                                                {
                                                                    var count = db.Calenders.Where(x => x.ShortName == name.ToString() && x.Date >= DayBegind && x.Date <= DayEnd).Count();
                                                                    <tr>

                                                                        <td class="text-center">@stt</td>
                                                                        <td class="text-center">@name.ToString()</td>
                                                                        <td class="text-center"> @count</td>
                                                                    </tr>
                                                                    stt++;
                                                                }

                                                            }
                                                        </tbody>
                                                    </table>
                                                </div>
                                            }
                                            else
                                            {
                                                List<string> TenKH = new List<string>();
                                                DateTime Now = DateTime.Now;
                                                var startDay = new DateTime(Now.Year, Now.Month, 1);
                                                var endDay = startDay.AddMonths(1).AddDays(-1);
                                                <div style=" margin-left: -5%;">
                                                    <ul>
                                                        <li>
                                                            <span>
                                                                <b>
                                                                    TỪ @startDay.ToString("dd-MM-yyyy") - @endDay.ToString("dd-MM-yyyy")
                                                                </b>
                                                            </span>

                                                        </li>
                                                    </ul>
                                                </div>
                                                <div>
                                                    <table class="table table-bordered table-hover" id="table" width="100%" cellpadding="0">
                                                        <thead>
                                                            <tr>
                                                                <th width="30px" class="text-center">STT</th>
                                                                <th class="text-center">Tên kế hoạch</th>
                                                                <th class="text-center">Số lượng</th>
                                                            </tr>
                                                        </thead>
                                                        <tbody>
                                                            @{

                                                                var Data = db.Calenders.Where(x => x.Date >= startDay && x.Date <= endDay).ToList();
                                                                foreach (var dt in Data)
                                                                {
                                                                    TenKH.Add(dt.ShortName);

                                                                }
                                                                TenKH = TenKH.Distinct().ToList();
                                                                int stt = 1;
                                                                foreach (var name in TenKH)
                                                                {
                                                                    var count = db.Calenders.Where(x => x.ShortName == name.ToString() && x.Date >= startDay && x.Date <= endDay).Count();
                                                                    <tr>

                                                                        <td class="text-center">@stt</td>
                                                                        <td class="text-center">@name.ToString()</td>
                                                                        <td class="text-center"> @count</td>
                                                                    </tr>
                                                                    stt++;
                                                                }

                                                            }
                                                        </tbody>
                                                    </table>
                                                </div>
                                            }

                                        </div>

                                    </div>
                                }

                            </div>

                            <div>
                                @{ var begind = Request.QueryString["begind"];
                                    var endd = Request.QueryString["endd"];
                                    if (begind != null || endd != null)
                                    {
                                        DateTime now = DateTime.Now;
                                        var Begind = DateTime.ParseExact(begind, "yyyy-MM-dd", System.Globalization.CultureInfo.InvariantCulture, System.Globalization.DateTimeStyles.None);
                                        var Endd = DateTime.ParseExact(endd, "yyyy-MM-dd", System.Globalization.CultureInfo.InvariantCulture, System.Globalization.DateTimeStyles.None);
                                        var mm = (begind == null ? (DateTime.Now.ToString("MM")) : Begind.ToString("MM"));
                                        var yyyy = (endd == null ? (DateTime.Now.ToString("yyyy")) : Endd.ToString("yyyy"));
                                        int num_days = DateTime.DaysInMonth(Convert.ToInt32(yyyy), Convert.ToInt32(mm));
                                        int number = 1;
                                        int lenght = 0;
                                        var yyyyb = (begind == null ? (DateTime.Now.ToString("yyyy")) : Begind.ToString("yyyy"));
                                        var mmEnd = (endd == null ? (DateTime.Now.ToString("MM")) : Endd.ToString("MM"));
                                        var block= "block";
                                        var none = "none";
                                        var display = block;
                                        nam = yyyy;

                                        if (mm  != mmEnd) {
                                            ////
                                            var mmb = Convert.ToInt32(mm);
                                            var mme = Convert.ToInt32(mmEnd);
                                            for (int b = mmb; mme >= b; b++) {
                                                var bStr = b.ToString();
                                                if (bStr.Length<2) { bStr = "0" + bStr; }
                                                begind = yyyyb+"-"+ bStr + "-01";

                                                DateTime dtResult = new DateTime(Convert.ToInt32(yyyyb), b, 1);
                                                dtResult = dtResult.AddMonths(1);
                                                dtResult = dtResult.AddDays(-(dtResult.Day));
                                                endd = yyyyb + "-" + bStr + "-"+dtResult.ToString("dd");

                                                now = DateTime.Now;
                                                Begind = DateTime.ParseExact(begind, "yyyy-MM-dd", System.Globalization.CultureInfo.InvariantCulture, System.Globalization.DateTimeStyles.None);
                                                Endd = DateTime.ParseExact(endd, "yyyy-MM-dd", System.Globalization.CultureInfo.InvariantCulture, System.Globalization.DateTimeStyles.None);
                                                mm = bStr;
                                                yyyy = (endd == null ? (DateTime.Now.ToString("yyyy")) : Endd.ToString("yyyy"));
                                                num_days = DateTime.DaysInMonth(Convert.ToInt32(yyyy), Convert.ToInt32(mm));
                                                number = 1;
                                                lenght = 0;
                                                var IDthang = bStr;
                                                if (b != mmb) { display = none; }
                                                listThang.Add(IDthang);
                                                <ul class="days" id="@IDthang" style="display: @display">

                                                    @for (int i = 1; i <= num_days; i++)
                                                    {
                                                        var Daynow = now.ToString("dd");
                                                        var Monthnow = now.ToString("MM");
                                                        var Data = db.Calenders.Where(x => x.Date >= Begind && x.Date <= Endd).ToList();
                                                        string check = number.ToString();
                                                        if (Convert.ToInt32(Daynow) == number && Monthnow == mm)
                                                        {
                                                            <li style="background-color: aquamarine; opacity: 0.8;">

                                                                <div style="display: flex; height: 100px;">
                                                                    <div style="margin: 15% 0 0 2%">
                                                                        <div style="margin-left: 2%;">
                                                                            @if (check.Length == 1)
                                                                            {
                                                                                <span style="font-size: 25px;">
                                                                                    <b> @lenght@number</b>
                                                                                </span>
                                                                            }
                                                                            else
                                                                            {
                                                                                <span style="font-size: 25px; ">
                                                                                    <b> @number</b>
                                                                                </span>
                                                                            }

                                                                        </div>
                                                                        <div class="pull-left" style="margin-top: 5%; font-size: 11px;">
                                                                            @{
                                                                                if (check.Length == 1)
                                                                                {
                                                                                    var Date = "0" + number + "-" + mm + "-" + yyyy.ToString();
                                                                                    var Day = DateTime.ParseExact(Date, "dd-MM-yyyy", System.Globalization.CultureInfo.InvariantCulture, System.Globalization.DateTimeStyles.None);
                                                                                    <span>
                                                                                        <b>
                                                                                            @Day.DayOfWeek
                                                                                        </b>
                                                                                    </span>
                                                                                }
                                                                                else
                                                                                {
                                                                                    var Date = number + "-" + mm + "-" + yyyy.ToString();
                                                                                    var Day = DateTime.ParseExact(Date, "dd-MM-yyyy", System.Globalization.CultureInfo.InvariantCulture, System.Globalization.DateTimeStyles.None);
                                                                                    <span>
                                                                                        <b>
                                                                                            @Day.DayOfWeek
                                                                                        </b>
                                                                                    </span>
                                                                                }

                                                                            }
                                                                        </div>

                                                                    </div>
                                                                    <div style="width: 100%; margin-top: auto; margin-bottom: auto; padding-left: 3%;">
                                                                        <div style="width: 100%; ">
                                                                            @foreach (var dis in Data)
                                                                            {
                                                                                var Check = db.Calenders.Where(x => x.IDPlan == dis.IDPlan).FirstOrDefault();
                                                                                if (Check.IDPlan == dis.IDPlan && Check.IDCalendar == Convert.ToInt32(number + mm + yyyy))
                                                                                {
                                                                                    if (Check.Status == 0)
                                                                                    {
                                                                                        <div style="padding-top: 1%;text-align: left;">
                                                                                            <a id="btn-edit_@dis.IDPlan" href="#" title="Chi tiết" class="btn-action"><i></i><b style="color: red;">@Check.ShortName.ToString()</b> </a>
                                                                                            <div class="modal " id="myModaleEdit_@dis.IDPlan" role="dialog" data-url='@Url.Action("Edit", "Calendar", new { id = @dis.IDPlan})'></div>
                                                                                            <script type="text/javascript">
                                                                                                $('#btn-edit_@dis.IDPlan').click(function () {
                                                                                                    var url = $('#myModaleEdit_@dis.IDPlan').data('url');
                                                                                                    $.get(url, function (data) {
                                                                                                        $("#myModal").html(data);
                                                                                                        $("#ModalTitle").html("Cập nhật Thông Tin dự án");
                                                                                                        $("#myModal").modal('show');
                                                                                                    });
                                                                                                });
                                                                                            </script>
                                                                                        </div>
                                                                                    }
                                                                                    else
                                                                                    {
                                                                                        <div style="padding-top: 1%;text-align: left; ">
                                                                                            <a id="btn-edit_@dis.IDPlan" href="#" title="Chi tiết" class="btn-action"><i></i><b style="color: #3f6ad8;">@Check.ShortName.ToString()</b> </a>
                                                                                            <div class="modal " id="myModaleEdit_@dis.IDPlan" role="dialog" data-url='@Url.Action("Edit", "Calendar", new { id = @dis.IDPlan})'></div>
                                                                                            <script type="text/javascript">
                                                                                                $('#btn-edit_@dis.IDPlan').click(function () {
                                                                                                    var url = $('#myModaleEdit_@dis.IDPlan').data('url');
                                                                                                    $.get(url, function (data) {
                                                                                                        $("#myModal").html(data);
                                                                                                        $("#ModalTitle").html("Cập nhật Thông Tin dự án");
                                                                                                        $("#myModal").modal('show');
                                                                                                    });
                                                                                                });
                                                                                            </script>
                                                                                        </div>
                                                                                    }
                                                                                }

                                                                            }
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </li>
                                                        }
                                                        else
                                                        {
                                                            <li style="background-color: white; opacity: 0.8;">
                                                                <div style="display: flex; height: 100px;">
                                                                    <div style="margin: 15% 0 0 2%">
                                                                        <div style="margin-left: 2%;">
                                                                            @if (check.Length == 1)
                                                                            {
                                                                                <span style="font-size: 25px; ">
                                                                                    <b> @lenght@number</b>
                                                                                </span>
                                                                            }
                                                                            else
                                                                            {
                                                                                <span style="font-size: 25px; ">
                                                                                    <b> @number</b>
                                                                                </span>
                                                                            }

                                                                        </div>
                                                                        <div class="pull-left" style="margin-top: 5%; font-size: 11px;">
                                                                            @{
                                                                                if (check.Length == 1)
                                                                                {
                                                                                    var Date = "0" + number + "-" + mm + "-" + yyyy.ToString();
                                                                                    var Day = DateTime.ParseExact(Date, "dd-MM-yyyy", System.Globalization.CultureInfo.InvariantCulture, System.Globalization.DateTimeStyles.None);
                                                                                    <span>
                                                                                        <b>
                                                                                            @Day.DayOfWeek
                                                                                        </b>
                                                                                    </span>
                                                                                }
                                                                                else
                                                                                {
                                                                                    var Date = number + "-" + mm + "-" + yyyy.ToString();
                                                                                    var Day = DateTime.ParseExact(Date, "dd-MM-yyyy", System.Globalization.CultureInfo.InvariantCulture, System.Globalization.DateTimeStyles.None);
                                                                                    <span>
                                                                                        <b>
                                                                                            @Day.DayOfWeek
                                                                                        </b>
                                                                                    </span>
                                                                                }

                                                                            }
                                                                        </div>

                                                                    </div>
                                                                    <div style="width: 100%; margin-top: auto; margin-bottom: auto; padding-left: 3%;">
                                                                        <div style="width: 100%;">
                                                                            @foreach (var dis in Data)
                                                                            {
                                                                                var Check = db.Calenders.Where(x => x.IDPlan == dis.IDPlan).FirstOrDefault();
                                                                                if (Check.IDPlan == dis.IDPlan && Check.IDCalendar == Convert.ToInt32(number + mm + yyyy))
                                                                                {
                                                                                    if (Check.Status == 0)
                                                                                    {
                                                                                        <div style="padding-top: 1%; text-align: left;">
                                                                                            <a id="btn-edit_@dis.IDPlan" href="#" title="Chi tiết" class="btn-action"><i></i><b style="color: red;">@Check.ShortName.ToString()</b> </a>
                                                                                            <div class="modal " id="myModaleEdit_@dis.IDPlan" role="dialog" data-url='@Url.Action("Edit", "Calendar", new { id = @dis.IDPlan})'></div>
                                                                                            <script type="text/javascript">
                                                                                                $('#btn-edit_@dis.IDPlan').click(function () {
                                                                                                    var url = $('#myModaleEdit_@dis.IDPlan').data('url');
                                                                                                    $.get(url, function (data) {
                                                                                                        $("#myModal").html(data);
                                                                                                        $("#ModalTitle").html("Cập nhật Thông Tin dự án");
                                                                                                        $("#myModal").modal('show');
                                                                                                    });
                                                                                                });
                                                                                            </script>
                                                                                        </div>
                                                                                    }
                                                                                    else
                                                                                    {
                                                                                        <div style="padding-top: 1%; text-align: left; ">
                                                                                            <a id="btn-edit_@dis.IDPlan" href="#" title="Chi tiết" class="btn-action"><i></i><b style="color: #3f6ad8;">@Check.ShortName.ToString()</b> </a>
                                                                                            <div class="modal " id="myModaleEdit_@dis.IDPlan" role="dialog" data-url='@Url.Action("Edit", "Calendar", new { id = @dis.IDPlan})'></div>
                                                                                            <script type="text/javascript">
                                                                                                $('#btn-edit_@dis.IDPlan').click(function () {
                                                                                                    var url = $('#myModaleEdit_@dis.IDPlan').data('url');
                                                                                                    $.get(url, function (data) {
                                                                                                        $("#myModal").html(data);
                                                                                                        $("#ModalTitle").html("Cập nhật Thông Tin dự án");
                                                                                                        $("#myModal").modal('show');
                                                                                                    });
                                                                                                });
                                                                                            </script>
                                                                                        </div>
                                                                                    }
                                                                                }

                                                                            }
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </li>
                                                        }

                                                        number++;
                                                    }
                                                </ul>
                                            }
                                        ///
                                        } else {
                                            <ul class="days">

                                                @for (int i = 1; i <= num_days; i++)
                                                {
                                                    var Daynow = now.ToString("dd");
                                                    var Monthnow = now.ToString("MM");
                                                    var Data = db.Calenders.Where(x => x.Date >= Begind && x.Date <= Endd).ToList();
                                                    string check = number.ToString();
                                                    if (Convert.ToInt32(Daynow) == number && Monthnow == mm)
                                                    {
                                                        <li style="background-color: aquamarine; opacity: 0.8;">

                                                            <div style="display: flex; height: 100px;">
                                                                <div style="margin: 15% 0 0 2%">
                                                                    <div style="margin-left: 2%;">
                                                                        @if (check.Length == 1)
                                                                        {
                                                                            <span style="font-size: 25px;">
                                                                                <b> @lenght@number</b>
                                                                            </span>
                                                                        }
                                                                        else
                                                                        {
                                                                            <span style="font-size: 25px; ">
                                                                                <b> @number</b>
                                                                            </span>
                                                                        }

                                                                    </div>
                                                                    <div class="pull-left" style="margin-top: 5%; font-size: 11px;">
                                                                        @{
                                                                            if (check.Length == 1)
                                                                            {
                                                                                var Date = "0" + number + "-" + mm + "-" + yyyy.ToString();
                                                                                var Day = DateTime.ParseExact(Date, "dd-MM-yyyy", System.Globalization.CultureInfo.InvariantCulture, System.Globalization.DateTimeStyles.None);
                                                                                <span>
                                                                                    <b>
                                                                                        @Day.DayOfWeek
                                                                                    </b>
                                                                                </span>
                                                                            }
                                                                            else
                                                                            {
                                                                                var Date = number + "-" + mm + "-" + yyyy.ToString();
                                                                                var Day = DateTime.ParseExact(Date, "dd-MM-yyyy", System.Globalization.CultureInfo.InvariantCulture, System.Globalization.DateTimeStyles.None);
                                                                                <span>
                                                                                    <b>
                                                                                        @Day.DayOfWeek
                                                                                    </b>
                                                                                </span>
                                                                            }

                                                                        }
                                                                    </div>

                                                                </div>
                                                                <div style="width: 100%; margin-top: auto; margin-bottom: auto; padding-left: 3%;">
                                                                    <div style="width: 100%; ">
                                                                        @foreach (var dis in Data)
                                                                        {
                                                                            var Check = db.Calenders.Where(x => x.IDPlan == dis.IDPlan).FirstOrDefault();
                                                                            if (Check.IDPlan == dis.IDPlan && Check.IDCalendar == Convert.ToInt32(number + mm + yyyy))
                                                                            {
                                                                                if (Check.Status == 0)
                                                                                {
                                                                                    <div style="padding-top: 1%;text-align: left;">
                                                                                        <a id="btn-edit_@dis.IDPlan" href="#" title="Chi tiết" class="btn-action"><i></i><b style="color: red;">@Check.ShortName.ToString()</b> </a>
                                                                                        <div class="modal " id="myModaleEdit_@dis.IDPlan" role="dialog" data-url='@Url.Action("Edit", "Calendar", new { id = @dis.IDPlan})'></div>
                                                                                        <script type="text/javascript">
                                                        $('#btn-edit_@dis.IDPlan').click(function () {
                                                            var url = $('#myModaleEdit_@dis.IDPlan').data('url');
                                                            $.get(url, function (data) {
                                                                $("#myModal").html(data);
                                                                $("#ModalTitle").html("Cập nhật Thông Tin dự án");
                                                                $("#myModal").modal('show');
                                                            });
                                                        });
                                                                                        </script>
                                                                                    </div>
                                                                                }
                                                                                else
                                                                                {
                                                                                    <div style="padding-top: 1%;text-align: left; ">
                                                                                        <a id="btn-edit_@dis.IDPlan" href="#" title="Chi tiết" class="btn-action"><i></i><b style="color: #3f6ad8;">@Check.ShortName.ToString()</b> </a>
                                                                                        <div class="modal " id="myModaleEdit_@dis.IDPlan" role="dialog" data-url='@Url.Action("Edit", "Calendar", new { id = @dis.IDPlan})'></div>
                                                                                        <script type="text/javascript">
                                                        $('#btn-edit_@dis.IDPlan').click(function () {
                                                            var url = $('#myModaleEdit_@dis.IDPlan').data('url');
                                                            $.get(url, function (data) {
                                                                $("#myModal").html(data);
                                                                $("#ModalTitle").html("Cập nhật Thông Tin dự án");
                                                                $("#myModal").modal('show');
                                                            });
                                                        });
                                                                                        </script>
                                                                                    </div>
                                                                                }
                                                                            }

                                                                        }
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </li>
                                                    }
                                                    else
                                                    {
                                                        <li style="background-color: white; opacity: 0.8;">
                                                            <div style="display: flex; height: 100px;">
                                                                <div style="margin: 15% 0 0 2%">
                                                                    <div style="margin-left: 2%;">
                                                                        @if (check.Length == 1)
                                                                        {
                                                                            <span style="font-size: 25px; ">
                                                                                <b> @lenght@number</b>
                                                                            </span>
                                                                        }
                                                                        else
                                                                        {
                                                                            <span style="font-size: 25px; ">
                                                                                <b> @number</b>
                                                                            </span>
                                                                        }

                                                                    </div>
                                                                    <div class="pull-left" style="margin-top: 5%; font-size: 11px;">
                                                                        @{
                                                                            if (check.Length == 1)
                                                                            {
                                                                                var Date = "0" + number + "-" + mm + "-" + yyyy.ToString();
                                                                                var Day = DateTime.ParseExact(Date, "dd-MM-yyyy", System.Globalization.CultureInfo.InvariantCulture, System.Globalization.DateTimeStyles.None);
                                                                                <span>
                                                                                    <b>
                                                                                        @Day.DayOfWeek
                                                                                    </b>
                                                                                </span>
                                                                            }
                                                                            else
                                                                            {
                                                                                var Date = number + "-" + mm + "-" + yyyy.ToString();
                                                                                var Day = DateTime.ParseExact(Date, "dd-MM-yyyy", System.Globalization.CultureInfo.InvariantCulture, System.Globalization.DateTimeStyles.None);
                                                                                <span>
                                                                                    <b>
                                                                                        @Day.DayOfWeek
                                                                                    </b>
                                                                                </span>
                                                                            }

                                                                        }
                                                                    </div>

                                                                </div>
                                                                <div style="width: 100%; margin-top: auto; margin-bottom: auto; padding-left: 3%; ">
                                                                    <div style="width: 100%; ">
                                                                        @foreach (var dis in Data)
                                                                        {
                                                                            var Check = db.Calenders.Where(x => x.IDPlan == dis.IDPlan).FirstOrDefault();
                                                                            if (Check.IDPlan == dis.IDPlan && Check.IDCalendar == Convert.ToInt32(number + mm + yyyy))
                                                                            {
                                                                                if (Check.Status == 0)
                                                                                {
                                                                                    <div style="padding-top: 1%; text-align: left;">
                                                                                        <a id="btn-edit_@dis.IDPlan" href="#" title="Chi tiết" class="btn-action"><i></i><b style="color: red;">@Check.ShortName.ToString()</b> </a>
                                                                                        <div class="modal " id="myModaleEdit_@dis.IDPlan" role="dialog" data-url='@Url.Action("Edit", "Calendar", new { id = @dis.IDPlan})'></div>
                                                                                        <script type="text/javascript">
                                                        $('#btn-edit_@dis.IDPlan').click(function () {
                                                            var url = $('#myModaleEdit_@dis.IDPlan').data('url');
                                                            $.get(url, function (data) {
                                                                $("#myModal").html(data);
                                                                $("#ModalTitle").html("Cập nhật Thông Tin dự án");
                                                                $("#myModal").modal('show');
                                                            });
                                                        });
                                                                                        </script>
                                                                                    </div>
                                                                                }
                                                                                else
                                                                                {
                                                                                    <div style="padding-top: 1%; text-align: left; ">
                                                                                        <a id="btn-edit_@dis.IDPlan" href="#" title="Chi tiết" class="btn-action"><i></i><b style="color: #3f6ad8;">@Check.ShortName.ToString()</b> </a>
                                                                                        <div class="modal " id="myModaleEdit_@dis.IDPlan" role="dialog" data-url='@Url.Action("Edit", "Calendar", new { id = @dis.IDPlan})'></div>
                                                                                        <script type="text/javascript">
                                                        $('#btn-edit_@dis.IDPlan').click(function () {
                                                            var url = $('#myModaleEdit_@dis.IDPlan').data('url');
                                                            $.get(url, function (data) {
                                                                $("#myModal").html(data);
                                                                $("#ModalTitle").html("Cập nhật Thông Tin dự án");
                                                                $("#myModal").modal('show');
                                                            });
                                                        });
                                                                                        </script>
                                                                                    </div>
                                                                                }
                                                                            }

                                                                        }
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </li>
                                                    }

                                                    number++;
                                                }
                                            </ul>
                                        }

                                        
                                    }
                                    else
                                    {
                                        DateTime now = DateTime.Now;
                                        var startDate = new DateTime(now.Year, now.Month, 1);
                                        var endDate = startDate.AddMonths(1).AddDays(-1);
                                        var mm = DateTime.Now.ToString("MM");
                                        var yyyy = DateTime.Now.ToString("yyyy");
                                        int num_days = DateTime.DaysInMonth(Convert.ToInt32(yyyy), Convert.ToInt32(mm));
                                        int number = 1;
                                        int lenght = 0;
                                        <ul class="days">

                                            @for (int i = 1; i <= num_days; i++)
                                            {
                                                var Daynow = now.ToString("dd");
                                                var Data = db.Calenders.Where(x => x.Date >= startDate && x.Date <= endDate).ToList();
                                                string check = number.ToString();
                                                if (Convert.ToInt32(Daynow) == number)
                                                {
                                                    <li style="background-color: aquamarine; opacity: 0.8;">
                                                        <div style="display: flex; height: 100px;">
                                                            <div style="margin: 15% 0 0 2%">
                                                                <div style="margin-left: 2%;">
                                                                    @if (check.Length == 1)
                                                                    {
                                                                        <span style="font-size: 25px;">
                                                                            <b> @lenght@number</b>
                                                                        </span>
                                                                    }
                                                                    else
                                                                    {
                                                                        <span style="font-size: 25px; ">
                                                                            <b> @number</b>
                                                                        </span>
                                                                    }

                                                                </div>
                                                                <div class="pull-left" style="margin-top: 5%; font-size: 11px;">
                                                                    @{
                                                                        if (check.Length == 1)
                                                                        {
                                                                            var Date = "0" + number + "-" + mm + "-" + yyyy.ToString();
                                                                            var Day = DateTime.ParseExact(Date, "dd-MM-yyyy", System.Globalization.CultureInfo.InvariantCulture, System.Globalization.DateTimeStyles.None);
                                                                            <span>
                                                                                <b>
                                                                                    @Day.DayOfWeek
                                                                                </b>
                                                                            </span>
                                                                        }
                                                                        else
                                                                        {
                                                                            var Date = number + "-" + mm + "-" + yyyy.ToString();
                                                                            var Day = DateTime.ParseExact(Date, "dd-MM-yyyy", System.Globalization.CultureInfo.InvariantCulture, System.Globalization.DateTimeStyles.None);
                                                                            <span>
                                                                                <b>
                                                                                    @Day.DayOfWeek
                                                                                </b>
                                                                            </span>
                                                                        }

                                                                    }
                                                                </div>

                                                            </div>
                                                            <div style="width: 100%; margin-top: auto; margin-bottom: auto; padding-left: 3%; ">
                                                                <div style="width: 100%; ">
                                                                    @foreach (var dis in Data)
                                                                    {
                                                                        var Check = db.Calenders.Where(x => x.IDPlan == dis.IDPlan).FirstOrDefault();
                                                                        if (Check.IDPlan == dis.IDPlan && Check.IDCalendar == Convert.ToInt32(number + mm + yyyy))
                                                                        {
                                                                            if (Check.Status == 0)
                                                                            {
                                                                                <div style="padding-top: 1%; text-align: left;">
                                                                                    <a id="btn-edit_@dis.IDPlan" href="#" title="Chi tiết" class="btn-action"><i></i><b style="color: red;">@Check.ShortName.ToString()</b> </a>
                                                                                    <div class="modal " id="myModaleEdit_@dis.IDPlan" role="dialog" data-url='@Url.Action("Edit", "Calendar", new { id = @dis.IDPlan})'></div>
                                                                                    <script type="text/javascript">
                                                                            $('#btn-edit_@dis.IDPlan').click(function () {
                                                                                var url = $('#myModaleEdit_@dis.IDPlan').data('url');
                                                                                $.get(url, function (data) {
                                                                                    $("#myModal").html(data);
                                                                                    $("#ModalTitle").html("Cập nhật Thông Tin dự án");
                                                                                    $("#myModal").modal('show');
                                                                                });
                                                                            });
                                                                                    </script>
                                                                                </div>
                                                                            }
                                                                            else
                                                                            {
                                                                                <div style="padding-top: 1%; text-align: left; ">
                                                                                    <a id="btn-edit_@dis.IDPlan" href="#" title="Chi tiết" class="btn-action"><i></i><b style="color: #3f6ad8;">@Check.ShortName.ToString()</b> </a>
                                                                                    <div class="modal " id="myModaleEdit_@dis.IDPlan" role="dialog" data-url='@Url.Action("Edit", "Calendar", new { id = @dis.IDPlan})'></div>
                                                                                    <script type="text/javascript">
                                                                            $('#btn-edit_@dis.IDPlan').click(function () {
                                                                                var url = $('#myModaleEdit_@dis.IDPlan').data('url');
                                                                                $.get(url, function (data) {
                                                                                    $("#myModal").html(data);
                                                                                    $("#ModalTitle").html("Cập nhật Thông Tin dự án");
                                                                                    $("#myModal").modal('show');
                                                                                });
                                                                            });
                                                                                    </script>
                                                                                </div>
                                                                            }
                                                                        }

                                                                    }
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </li>
                                                }
                                                else
                                                {
                                                    <li style="background-color: white; opacity: 0.8;">
                                                        <div style="display: flex; height: 100px;">
                                                            <div style="margin: 15% 0 0 2%">
                                                                <div style="margin-left: 2%;">
                                                                    @if (check.Length == 1)
                                                                    {
                                                                        <span style="font-size: 25px; ">
                                                                            <b> @lenght@number</b>
                                                                        </span>
                                                                    }
                                                                    else
                                                                    {
                                                                        <span style="font-size: 25px; ">
                                                                            <b> @number</b>
                                                                        </span>
                                                                    }

                                                                </div>
                                                                <div class="pull-left" style="margin-top: 5%;font-size:11px;">
                                                                    @{
                                                                        if (check.Length == 1)
                                                                        {
                                                                            var Date = "0" + number + "-" + mm + "-" + yyyy.ToString();
                                                                            var Day = DateTime.ParseExact(Date, "dd-MM-yyyy", System.Globalization.CultureInfo.InvariantCulture, System.Globalization.DateTimeStyles.None);
                                                                            <span>
                                                                                <b>
                                                                                    @Day.DayOfWeek
                                                                                </b>
                                                                            </span>
                                                                        }
                                                                        else
                                                                        {
                                                                            var Date = number + "-" + mm + "-" + yyyy.ToString();
                                                                            var Day = DateTime.ParseExact(Date, "dd-MM-yyyy", System.Globalization.CultureInfo.InvariantCulture, System.Globalization.DateTimeStyles.None);
                                                                            <span>
                                                                                <b>
                                                                                    @Day.DayOfWeek
                                                                                </b>
                                                                            </span>
                                                                        }

                                                                    }
                                                                </div>

                                                            </div>
                                                            <div style="width: 100%; margin-top: auto; margin-bottom: auto; padding-left: 3%; ">
                                                                <div style="width: 100%; ">
                                                                    @foreach (var dis in Data)
                                                                    {
                                                                        var Check = db.Calenders.Where(x => x.IDPlan == dis.IDPlan).FirstOrDefault();
                                                                        if (Check.IDPlan == dis.IDPlan && Check.IDCalendar == Convert.ToInt32(number + mm + yyyy))
                                                                        {
                                                                            if (Check.Status == 0)
                                                                            {
                                                                                <div style="padding-top: 1%;text-align: left;">
                                                                                    <a id="btn-edit_@dis.IDPlan" href="#" title="Chi tiết" class="btn-action"><i></i><b style="color: red;">@Check.ShortName.ToString()</b> </a>
                                                                                    <div class="modal " id="myModaleEdit_@dis.IDPlan" role="dialog" data-url='@Url.Action("Edit", "Calendar", new { id = @dis.IDPlan})'></div>
                                                                                    <script type="text/javascript">
                                                                            $('#btn-edit_@dis.IDPlan').click(function () {
                                                                                var url = $('#myModaleEdit_@dis.IDPlan').data('url');
                                                                                $.get(url, function (data) {
                                                                                    $("#myModal").html(data);
                                                                                    $("#ModalTitle").html("Cập nhật Thông Tin dự án");
                                                                                    $("#myModal").modal('show');
                                                                                });
                                                                            });
                                                                                    </script>
                                                                                </div>
                                                                            }
                                                                            else
                                                                            {
                                                                                <div style="padding-top: 1%;text-align: left; ">
                                                                                    <a id="btn-edit_@dis.IDPlan" href="#" title="Chi tiết" class="btn-action"><i></i><b style="color: #3f6ad8;">@Check.ShortName.ToString()</b> </a>
                                                                                    <div class="modal " id="myModaleEdit_@dis.IDPlan" role="dialog" data-url='@Url.Action("Edit", "Calendar", new { id = @dis.IDPlan})'></div>
                                                                                    <script type="text/javascript">
                                                                            $('#btn-edit_@dis.IDPlan').click(function () {
                                                                                var url = $('#myModaleEdit_@dis.IDPlan').data('url');
                                                                                $.get(url, function (data) {
                                                                                    $("#myModal").html(data);
                                                                                    $("#ModalTitle").html("Cập nhật Thông Tin dự án");
                                                                                    $("#myModal").modal('show');
                                                                                });
                                                                            });
                                                                                    </script>
                                                                                </div>
                                                                            }
                                                                        }

                                                                    }
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </li>
                                                }

                                                number++;
                                            }
                                        </ul>
                                    }

                                }

                            </div>

                        </div>
                        @{if (listThang.Count > 0) { 
                                <div class="pagination">
                                    <a href="#" onclick="backthang();" class="backUp"><i class="fa fa-reply" aria-hidden="true"></i></a>
                                    @{ foreach (var item in listThang)
                                        {
                                            var id = "S" + item;
                                            if (item == listThang[0])
                                            {

                                                <a href="#" id=@id class="active" onclick="showThang(this);">@item/@nam</a>
                                            }
                                            else
                                            {<a href="#" id=@id onclick="showThang(this);">@item/@nam</a> }

                                    }
                                    }
                                    <a href="#" onclick="upthang();" class="backUp"><i class="fa fa-share" aria-hidden="true"></i></a>
                                </div> 
                                } 
                          }
                    </div>
                </div>
            </div>
        </div>
    </div>


    <div class="app-wrapper-footer">
        <div class="app-footer">
            <div class="app-footer__inner">

            </div>
        </div>
    </div>


</div>

<script type="text/javascript">
    function IsAlreadyCLD() {
        var Date = $("#Date").val();
        var ShortName = $("#ShortName").val();
        if (Date == "" || ShortName == "") {
            return;
        }
        var ErrorShortName = document.getElementById("ErrorShortName");
        ErrorShortName.innerHTML = "";
        return $.ajax({
            type: "POST",
            url: "/Calendar/IsAlreadyCLD?IDCalendar=" + Date + "&ShortName=" + ShortName,
            success: function (result) {
                if (result == false) {
                    $("#ShortName").focus();
                    ErrorShortName.innerHTML = "ShortName đã tồn tại!";
                    //event.preventDefault();
                } 

            }
        });
        
    };
    $(document).ready(function () {
        const queryString = window.location.search;
        const urlParams = new URLSearchParams(queryString);
        if (urlParams.has('thang')) {
            const thang = urlParams.get('thang')
            $(".pagination a").removeClass("active");
            $("#S" + thang).addClass("active");
            /*var id =el.id.replace('S+', '');*/
            $(".days").css("display", "none");
            $("#" + thang).css("display", "block");
            document.getElementById("thang").innerHTML = "Tháng " + thang + "/@nam";
        }
    });
    function showThang(el) {
        $(".pagination a").removeClass("active");
        $(el).closest('a').addClass("active");
        var id =el.id.replace('S', '');
        $(".days").css("display", "none");
        $("#" + id).css("display", "block");
        var url = "";
        const queryString = window.location.search;
        const urlParams = new URLSearchParams(queryString);
        if (urlParams.has('thang')) {
            urlParams.set('thang', id);
            url = window.location.href.split('?')[0] + "?" + urlParams.toString();
            //window.location.href = window.location.href.split('?')[0] + "?" + urlParams.toString();
        } else {
            url = document.location.href + "&thang=" + id;
            //window.location.href = url;
        }
        //var url = document.location.href + "&thang=" + id;
        window.history.replaceState({}, '', url);
        document.getElementById("thang").innerHTML = "Tháng "+ id + "/@nam";
    };

    function backthang() {
        $(".pagination a").each(function (index) {
            if ($(this).hasClass("active")) {
                if (this != $(".pagination a")[1]) {
                    showThang($(".pagination a")[index - 1]);
                    return false;
                }
            };
        });
    };
    function upthang() {
        $(".pagination a").each(function (index) {
            if ($(this).hasClass("active")) {
                if (this != $(".pagination a")[$(".pagination a").length - 2]) {
                    showThang($(".pagination a")[index + 1]);
                    return false;
                }
            };
        });
    };

    $('#btn-add').click(function () {
        var url = $('#myModal').data('url');
        $.get(url, function (data) {
            $("#myModal").html(data);
            $("#ModalTitle").html("Thêm kế hoạch bay");
            $("#myModal").modal('show');
        });
    });
        $('#btn-Export').click(function () {
        window.location.href = '@Url.Action("ExportToExcel", "Calendar")?IDPhongBan=' + $('#IDPhongBan').val() + '&begind=' + $('#begind').val() + '&endd=' + $('#endd').val();

    });
    $('#btn-Import').click(function () {
        var url = $('#myModalImport').data('url');
        $.get(url, function (data) {
            $("#myModal").html(data);
            $("#ModalTitle").html("Import dữ liệu kế hoạch");
            $("#myModal").modal('show');
        });
    });
     $("#btn-search").on('click', function () {
         var search = $('#txtsearch').val();
         var begind = Date.parse($('#begind').val());
         var endd = Date.parse($('#endd').val());
         if (endd < begind) {
             alert('Ngày kết thúc phải lớn hơn hoặc bằng ngày bắt đầu');
             return false;
         }
         var partsB = $('#begind').val().split("-");
         var yearB = parseInt(partsB[0], 10);
         var partsE = $('#endd').val().split("-");
         var yearE = parseInt(partsE[0], 10);
         if (yearE != yearB) {
             alert('Chọn ngày trong cùng năm');
             return false;
         }
         window.location.href = '@Url.Action("Index", "Calendar")?search=' + search + '&begind=' + $('#begind').val() + '&endd=' + $('#endd').val();
     });
    $(document).ready(function () {



        var dateNewFormat, onlyLastDate, onlyFirstDate;
        var now = new Date();

        var prevMonthLastDate = new Date(now.getFullYear(), now.getMonth(), 1);
        var prevMonthFirstDate = new Date(now.getFullYear(), now.getMonth() + 1, 0);

        //prevMonthFirstDate
        dateFirstDate = prevMonthFirstDate.getFullYear() + '-';
        if (prevMonthFirstDate.getMonth() >= 9) {

            dateFirstDate += (prevMonthFirstDate.getMonth() + 1);
        }
        else {
            dateFirstDate += '0' + (prevMonthFirstDate.getMonth() + 1);
        }

        onlyFirstDate = prevMonthFirstDate.getDate();

        if (onlyFirstDate.toString().length == 2) {

            dateFirstDate += "-" + onlyFirstDate;
        }
        else {
            dateFirstDate += '-0' + onlyFirstDate;
        }
        console.log(dateFirstDate)


         //prevMonthLastDate
        dateLastDate = prevMonthLastDate.getFullYear() + '-';
        if (prevMonthLastDate.getMonth() >= 9) {

            dateLastDate += (prevMonthLastDate.getMonth() + 1);
        }
        else {
            dateLastDate += '0' + (prevMonthLastDate.getMonth() + 1);
        }

        onlyLastDate = prevMonthLastDate.getDate();

        if (onlyLastDate.toString().length == 2) {

            dateLastDate += "-" + onlyLastDate;
        }
        else {
            dateLastDate += '-0' + onlyLastDate;
        }
        console.log(dateLastDate)


        if ($('#begind').val() == '') {
            $('#begind').val(dateLastDate);
        }
        else {
            ($('#begind').val());
            console.log($('#begind').val())
        }
        if ($('#endd').val() == '') {
            $('#endd').val(dateFirstDate);
        }
    });
</script>





